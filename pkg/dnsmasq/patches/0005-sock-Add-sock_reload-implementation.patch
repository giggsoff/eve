From f92abb738bed969a601eec6aeac0067601c45060 Mon Sep 17 00:00:00 2001
From: Sergey Temerkhanov <s.temerkhanov@gmail.com>
Date: Thu, 8 Oct 2020 18:04:49 -0400
Subject: [PATCH 5/9] sock: Add sock_reload() implementation

Implement config reload command via the control socket

Signed-off-by: Sergey Temerkhanov <s.temerkhanov@gmail.com>
---
 src/sock.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/src/sock.c b/src/sock.c
index 021d43f..fcf391e 100644
--- a/src/sock.c
+++ b/src/sock.c
@@ -61,6 +61,14 @@ struct command {
   int (*handler)(char *args, time_t now);
 };
 
+static int sock_reload(char *args, time_t now)
+{
+  (void)args;
+  clear_cache_and_reload(now);
+
+  return 0;
+}
+
 static int sock_del_lease(char *args, time_t now)
 {
   char *ipaddr = args;
@@ -147,6 +155,8 @@ static int sock_add_lease(char *args, time_t now)
 }
 
 static const struct command handlers[] = {
+  {.cmd = "reload", .handler = sock_reload},
+  /* reload */
   {.cmd = "del_lease", .handler = sock_del_lease},
   /* del_lease <IP address> */
   {.cmd = "add_lease", .handler = sock_add_lease},
-- 
2.26.2

